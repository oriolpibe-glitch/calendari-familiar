<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>CALENDARI PIBES</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #161616;
            --surface-light: #222222;
            --text: #ffffff;
            --text-dim: #a0a0a0;
            --gold: #d4af37;
            --gold-gradient: linear-gradient(135deg, #d4af37 0%, #f7e08a 50%, #b8860b 100%);
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            
            /* Colors Usuaris */
            --paula: #fbc531; --oriol: #4cd137; --albert: #00a8ff; --natalia: #e84393;
        }

        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--bg);
            color: var(--text);
            overflow: hidden;
        }

        /* --- LOGIN SCREEN --- */
        #login { 
            position: fixed; inset: 0; background: var(--bg); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px 20px;
        }
        
        .logo-container { text-align: center; margin-bottom: 50px; }
        .logo-main { 
            font-size: 2.2rem; font-weight: 900; letter-spacing: 8px; 
            background: var(--gold-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-transform: uppercase; margin: 0;
        }
        .logo-sub { font-size: 0.6rem; color: var(--text-dim); letter-spacing: 4px; margin-top: 10px; }
        
        /* SIGNATURA ORIOL */
        .credits { font-size: 0.6rem; color: var(--gold); letter-spacing: 2px; text-transform: uppercase; margin-top: 15px; font-weight: 800; opacity: 0.8; }

        .login-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 16px; 
            width: 100%; max-width: 360px; 
        }
        .user-card { 
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 30px 10px; border-radius: 20px; text-align: center;
            font-weight: 600; font-size: 0.85rem; letter-spacing: 1px;
            transition: all 0.3s ease; backdrop-filter: blur(10px);
        }
        .user-card:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }

        /* --- MAIN APP --- */
        #app { display: none; flex-direction: column; height: 100vh; width: 100%; }
        
        header { 
            padding: env(safe-area-inset-top, 20px) 20px 15px; 
            background: rgba(10,10,10,0.8); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .header-user { font-size: 0.9rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .user-dot { width: 8px; height: 8px; border-radius: 50%; }
        .header-title { font-size: 0.7rem; letter-spacing: 3px; font-weight: 800; color: var(--gold); text-transform: uppercase; }

        .content { 
            flex: 1; overflow-y: auto; padding: 10px 20px 120px;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
        }

        /* --- LIST STYLING --- */
        .day-group { margin-top: 30px; }
        .day-header { 
            position: sticky; top: 0; background: var(--bg); padding: 10px 0; z-index: 5;
            font-size: 0.75rem; font-weight: 800; color: var(--text-dim);
            text-transform: uppercase; letter-spacing: 1.5px; display: flex; align-items: center; gap: 10px;
        }
        .day-header::after { content: ""; flex: 1; height: 1px; background: linear-gradient(90deg, var(--glass-border), transparent); }

        .event-card { 
            background: var(--surface); border: 1px solid var(--glass-border);
            border-radius: 18px; padding: 18px; margin-bottom: 12px;
            display: flex; align-items: center; position: relative;
            overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .event-color-bar { position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        
        .event-main { flex: 1; min-width: 0; }
        .event-title { font-weight: 700; font-size: 1.05rem; margin-bottom: 4px; color: #fff; }
        .event-meta { font-size: 0.8rem; color: var(--text-dim); display: flex; align-items: center; gap: 8px; }
        .badge-series { 
            background: rgba(212, 175, 55, 0.15); color: var(--gold); 
            padding: 2px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 800; 
        }

        .btn-delete-trigger { 
            background: var(--glass); border-radius: 12px; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center; color: #444; border: none; font-size: 1.2rem;
        }

        /* --- MODALS --- */
        .modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            backdrop-filter: blur(15px); z-index: 2000; padding: 20px;
        }
        .modal-body { 
            max-width: 400px; margin: 40px auto; 
            background: var(--surface); border: 1px solid var(--glass-border);
            border-radius: 30px; padding: 30px; position: relative;
        }
        .modal-title { font-size: 1.2rem; font-weight: 800; text-align: center; margin-bottom: 25px; letter-spacing: 1px; }

        label { display: block; font-size: 0.65rem; font-weight: 800; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; margin-left: 4px; }
        input { 
            width: 100%; background: var(--bg); border: 1px solid var(--glass-border);
            padding: 16px; color: white; border-radius: 14px; font-size: 1rem; margin-bottom: 20px;
            outline: none; transition: border-color 0.3s;
        }
        input:focus { border-color: var(--gold); }

        .series-container { 
            background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; margin-bottom: 25px;
        }
        .days-row { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .day-pill { 
            background: var(--bg); border: 1px solid var(--glass-border);
            height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 0.7rem; font-weight: 700; color: #555; transition: all 0.2s;
        }
        .day-pill.active { background: var(--gold-gradient); color: #000; border-color: transparent; }

        .btn-primary { 
            background: var(--gold-gradient); color: #000; border: none; padding: 20px;
            width: 100%; border-radius: 16px; font-weight: 800; font-size: 0.9rem;
            text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 10px 20px rgba(212, 175, 55, 0.2);
        }
        .btn-cancel { 
            background: transparent; color: var(--text-dim); border: none; width: 100%; 
            padding: 15px; margin-top: 10px; font-weight: 600; font-size: 0.8rem;
        }
        .btn-danger { background: #ff4757; color: white; box-shadow: 0 10px 20px rgba(255, 71, 87, 0.2); }

        /* --- FAB --- */
        .fab { 
            position: fixed; bottom: 40px; right: 25px; width: 65px; height: 65px;
            background: var(--gold-gradient); border-radius: 22px; border: none;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 15px 30px rgba(0,0,0,0.4); transform: rotate(0deg); transition: 0.3s;
        }
        .fab svg { width: 28px; height: 28px; fill: #000; }
        .fab:active { transform: scale(0.9) rotate(90deg); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 10px; }

        .empty-state { text-align: center; margin-top: 100px; color: var(--text-dim); }
        .empty-state svg { width: 60px; height: 60px; opacity: 0.2; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="login">
        <div class="logo-container">
            <h1 class="logo-main">CALENDARI FAMILIAR</h1>
            <div class="logo-sub">CALENDARI PIBES</div>
            <div class="credits">Fet per Oriol Pibernat</div>
        </div>
        <div class="login-grid">
            <div class="user-card" onclick="login('PAULA', 'var(--paula)')" style="color: var(--paula); border-bottom: 3px solid var(--paula)">PAULA</div>
            <div class="user-card" onclick="login('ORIOL', 'var(--oriol)')" style="color: var(--oriol); border-bottom: 3px solid var(--oriol)">ORIOL</div>
            <div class="user-card" onclick="login('ALBERT', 'var(--albert)')" style="color: var(--albert); border-bottom: 3px solid var(--albert)">ALBERT</div>
            <div class="user-card" onclick="login('NATALIA', 'var(--natalia)')" style="color: var(--natalia); border-bottom: 3px solid var(--natalia)">NATÀLIA</div>
        </div>
    </div>

    <div id="app">
        <header>
            <div class="header-user" id="header-u-box">
                <div class="user-dot" id="u-dot"></div>
                <span id="u-name"></span>
            </div>
            <div class="header-title">Agenda</div>
            <div onclick="logout()" style="font-size: 0.6rem; font-weight: 800; color: var(--text-dim); cursor: pointer;">SORTIR</div>
        </header>
        
        <div class="content" id="list"></div>

        <button class="fab" onclick="openAdd()">
            <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
        </button>
    </div>

    <div id="m-add" class="modal">
        <div class="modal-body">
            <div class="modal-title">Nou Esdeveniment</div>
            
            <label>Activitat</label>
            <input type="text" id="in-desc" placeholder="Què fareu?">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label>Data Inici</label>
                    <input type="date" id="in-date">
                </div>
                <div>
                    <label>Hora</label>
                    <input type="time" id="in-time" value="09:00">
                </div>
            </div>

            <div class="series-container">
                <label style="text-align: center; margin-bottom: 12px;">Repetir cada setmana</label>
                <div class="days-row">
                    <div class="day-pill" data-v="1">dl</div><div class="day-pill" data-v="2">dm</div>
                    <div class="day-pill" data-v="3">dc</div><div class="day-pill" data-v="4">dj</div>
                    <div class="day-pill" data-v="5">dv</div><div class="day-pill" data-v="6">ds</div>
                    <div class="day-pill" data-v="0">dg</div>
                </div>
            </div>

            <button class="btn-primary" onclick="save()">Confirmar Esdeveniment</button>
            <button class="btn-cancel" onclick="closeM('m-add')">Tancar</button>
        </div>
    </div>

    <div id="m-del" class="modal">
        <div class="modal-body" style="text-align: center;">
            <div class="modal-title" style="margin-bottom: 10px;">Gestionar</div>
            <p id="del-info" style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 30px;"></p>
            
            <button class="btn-primary" style="background: #fff; margin-bottom: 12px;" id="btn-single">Esborrar només avui</button>
            <button class="btn-primary btn-danger" id="btn-series">Esborrar tota la sèrie</button>
            
            <button class="btn-cancel" onclick="closeM('m-del')">Cancel·lar</button>
        </div>
    </div>

    <script>
        let user = JSON.parse(localStorage.getItem('fg_pro_u'));
        let events = JSON.parse(localStorage.getItem('fg_pro_e')) || [];
        let tempDays = [];

        document.querySelectorAll('.day-pill').forEach(b => {
            b.onclick = () => {
                const v = parseInt(b.dataset.v);
                if(tempDays.includes(v)) {
                    tempDays = tempDays.filter(x => x !== v);
                    b.classList.remove('active');
                } else {
                    tempDays.push(v);
                    b.classList.add('active');
                }
            }
        });

        if(user) start();

        function login(n, c) {
            user = {n, c};
            localStorage.setItem('fg_pro_u', JSON.stringify(user));
            start();
        }

        function logout() {
            localStorage.removeItem('fg_pro_u');
            location.reload();
        }

        function start() {
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
            document.getElementById('u-name').innerText = user.n;
            document.getElementById('u-dot').style.backgroundColor = user.c;
            render();
        }

        function openAdd() {
            document.getElementById('m-add').style.display = 'block';
            document.getElementById('in-date').valueAsDate = new Date();
            tempDays = [];
            document.querySelectorAll('.day-pill').forEach(b => b.classList.remove('active'));
        }

        function closeM(id) { document.getElementById(id).style.display = 'none'; }

        function save() {
            const d = document.getElementById('in-desc').value;
            const dt = document.getElementById('in-date').value;
            const tm = document.getElementById('in-time').value;
            if(!d || !dt) return;

            events.push({
                id: Date.now(),
                d, dt, tm,
                days: [...tempDays],
                un: user.n, uc: user.c,
                ex: []
            });
            
            localStorage.setItem('fg_pro_e', JSON.stringify(events));
            closeM('m-add');
            document.getElementById('in-desc').value = "";
            render();
        }

        function openDel(id, dateKey, desc) {
            const ev = events.find(e => e.id === id);
            document.getElementById('m-del').style.display = 'block';
            document.getElementById('del-info').innerText = desc;

            document.getElementById('btn-single').onclick = () => {
                if(!ev.ex) ev.ex = [];
                ev.ex.push(dateKey);
                localStorage.setItem('fg_pro_e', JSON.stringify(events));
                closeM('m-del');
                render();
            };

            const seriesBtn = document.getElementById('btn-series');
            if(ev.days.length > 0) {
                seriesBtn.style.display = 'block';
                seriesBtn.onclick = () => {
                    events = events.filter(e => e.id !== id);
                    localStorage.setItem('fg_pro_e', JSON.stringify(events));
                    closeM('m-del');
                    render();
                };
            } else {
                seriesBtn.style.display = 'none';
            }
        }

        function render() {
            const list = document.getElementById('list');
            list.innerHTML = "";
            const today = new Date(); today.setHours(0,0,0,0);
            const dataMap = {};

            for(let i=0; i<30; i++) {
                let curr = new Date(today); curr.setDate(today.getDate() + i);
                let key = curr.toISOString().split('T')[0];
                let dw = curr.getDay();

                events.forEach(e => {
                    let startDt = new Date(e.dt); startDt.setHours(0,0,0,0);
                    let match = false;
                    if(e.days.length === 0 && e.dt === key) match = true;
                    if(e.days.length > 0 && curr >= startDt && e.days.includes(dw)) match = true;

                    if(match && (!e.ex || !e.ex.includes(key))) {
                        if(!dataMap[key]) dataMap[key] = [];
                        dataMap[key].push(e);
                    }
                });
            }

            const sorted = Object.keys(dataMap).sort();
            if(!sorted.length) {
                list.innerHTML = `
                <div class="empty-state">
                    <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z" fill="currentColor"/></svg>
                    <p>No tens activitats programades</p>
                </div>`;
                return;
            }

            sorted.forEach(k => {
                const dateObj = new Date(k);
                const label = dateObj.toLocaleDateString('ca-ES', {weekday:'long', day:'numeric', month:'short'});
                
                let dayContainer = document.createElement('div');
                dayContainer.className = "day-group";
                
                let html = `<div class="day-header">${label}</div>`;
                
                dataMap[k].sort((a,b) => a.tm.localeCompare(b.tm)).forEach(e => {
                    html += `
                        <div class="event-card">
                            <div class="event-color-bar" style="background:${e.uc}"></div>
                            <div class="event-main">
                                <div class="event-title">${e.d}</div>
                                <div class="event-meta">
                                    <span>${e.tm} h</span>
                                    <span style="color:${e.uc}; font-weight:800; font-size:0.65rem; text-transform:uppercase;">${e.un}</span>
                                    ${e.days.length ? '<span class="badge-series">SÈRIE</span>' : ''}
                                </div>
                            </div>
                            <button class="btn-delete-trigger" onclick="openDel(${e.id}, '${k}', '${e.d}')">×</button>
                        </div>
                    `;
                });
                dayContainer.innerHTML = html;
                list.appendChild(dayContainer);
            });
        }
    </script>
</body>
</html>
